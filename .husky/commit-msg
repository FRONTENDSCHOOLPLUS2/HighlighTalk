#!/bin/sh
. "$(dirname "$0")/_/husky.sh"


commitMsgFile=$1
commitRegex=".*#\d+"

branchName=$(git rev-parse --abbrev-ref HEAD)

branchIssueNumber=$(echo "$branchName" | awk -F'#' '{print $2}')
commitIssueNumber=$(grep -o '#[0-9]\+' "$commitMsgFile" | tr -d '#')

if ! grep -qE "$commitRegex" "$commitMsgFile"; then
  echo "ğŸ¥¸ ì»¤ë°‹ ë©”ì‹œì§€ì— ì´ìŠˆ ë²ˆí˜¸ê°€ í¬í•¨ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤."
  echo "ì´ìŠˆ ë²ˆí˜¸ë¥¼ í¬í•¨í•´ì£¼ì„¸ìš” (ì˜ˆ: #123)."
  exit 1
fi


if [ "$branchIssueNumber" != "$commitIssueNumber" ]; then
  echo "ğŸ‘½ ë¸Œëœì¹˜ ì´ë¦„ì˜ ì´ìŠˆ ë²ˆí˜¸ ($branchIssueNumber)ì™€ ì»¤ë°‹ ë©”ì‹œì§€ì˜ ì´ìŠˆ ë²ˆí˜¸ ($commitIssueNumber)ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
  exit 1
fi

commit_msg_file=$1
commit_msg=$(cat "$commit_msg_file")

valid_prefixes="Feat|Fix|Design|Refactor|Style|Docs|Test|Chore|Dir|Rename|Remove|HotFix|WIP"

if ! echo "$commit_msg" | grep -qE "^($valid_prefixes): .+"; then
    echo "Error: ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì»¤ë°‹ ë©”ì‹œì§€ í˜•ì‹ì…ë‹ˆë‹¤."
    echo "ì»¤ë°‹ ë©”ì‹œì§€ëŠ” 'Prefix: ì‘ì—… ë‚´ìš© #ì´ìŠˆë„˜ë²„' í˜•íƒœì—¬ì•¼ í•©ë‹ˆë‹¤."
    echo "í—ˆìš©ëœ Prefix: $valid_prefixes"
    exit 1
fi

echo "ğŸ”† ì˜¤ëŠ˜ë„ ì»¨ë²¤ì…˜ì„ ì§€ì¼œì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤ ğŸ”†"